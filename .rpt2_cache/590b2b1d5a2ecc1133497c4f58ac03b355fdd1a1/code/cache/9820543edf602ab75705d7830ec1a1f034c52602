{"code":"import Player from '../../model/player/player';\r\nimport { AreaStatsService } from '../area/areaStatsService';\r\nvar PlayerStateModificationService = /** @class */ (function () {\r\n    function PlayerStateModificationService() {\r\n    }\r\n    PlayerStateModificationService.raidPowerToken = function (state, source, target) {\r\n        var targetArea = state.areas.get(target);\r\n        var sourceArea = state.areas.get(source);\r\n        if (targetArea.orderToken.isConsolidatePowerToken()) {\r\n            var newPlayers = state.players.slice(0);\r\n            newPlayers.filter(function (player) {\r\n                return player.house === targetArea.controllingHouse;\r\n            }).map(function (player) {\r\n                if (player.powerToken > 0) {\r\n                    player.powerToken--;\r\n                }\r\n            });\r\n            newPlayers.filter(function (player) {\r\n                return player.house === sourceArea.controllingHouse;\r\n            })[0].powerToken++;\r\n            return newPlayers;\r\n        }\r\n        return state.players;\r\n    };\r\n    PlayerStateModificationService.establishControl = function (players, establishControl, house) {\r\n        if (establishControl) {\r\n            var newPlayers = players.slice(0);\r\n            newPlayers.filter(function (player) {\r\n                return player.house === house;\r\n            })[0].powerToken--;\r\n            return newPlayers;\r\n        }\r\n        return players;\r\n    };\r\n    PlayerStateModificationService.consolidateAllPower = function (state) {\r\n        var newPlayers = [];\r\n        state.players.forEach(function (player) {\r\n            var additionalPower = 0;\r\n            Array.from(state.areas.values()).forEach(function (area) {\r\n                if (area.controllingHouse === player.house) {\r\n                    additionalPower += AreaStatsService.getInstance().areaStats.get(area.key).consolidatePower;\r\n                }\r\n            });\r\n            var newPlayer = player.copy();\r\n            newPlayer.powerToken += additionalPower;\r\n            newPlayers.push(newPlayer);\r\n        });\r\n        // Add logic for ships in harbour\r\n        return newPlayers;\r\n    };\r\n    PlayerStateModificationService.executeAllConsolidatePowerOrders = function (players, areas) {\r\n        var updatedPlayers = players.slice(0);\r\n        areas.filter(function (area) {\r\n            return area.orderToken && area.orderToken.isConsolidatePowerToken();\r\n        }).map(function (area) {\r\n            area.orderToken = null;\r\n            var additionalPowerToken = AreaStatsService.getInstance().areaStats.get(area.key).consolidatePower + 1;\r\n            var player = updatedPlayers.filter(function (player) {\r\n                return player.house === area.controllingHouse;\r\n            })[0];\r\n            var indexOfPlayer = updatedPlayers.lastIndexOf(player);\r\n            var newPlayer = player.copy();\r\n            newPlayer.powerToken += additionalPowerToken;\r\n            updatedPlayers[indexOfPlayer] = newPlayer;\r\n        });\r\n        return updatedPlayers;\r\n    };\r\n    PlayerStateModificationService.initPlayers = function (playerSetup) {\r\n        var INITIAL_POWER_TOKEN = 5;\r\n        var players = [];\r\n        playerSetup.forEach(function (config) {\r\n            players.push(new Player(config.house, INITIAL_POWER_TOKEN));\r\n        });\r\n        return players;\r\n    };\r\n    return PlayerStateModificationService;\r\n}());\r\nexport default PlayerStateModificationService;\r\n//# sourceMappingURL=playerStateModificationService.js.map","map":{"version":3,"file":"playerStateModificationService.js","sourceRoot":"","sources":["playerStateModificationService.ts"],"names":[],"mappings":"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"},"dts":{"name":"/Users/taamato1/pdev/got-store/src/logic/gameState/playerStateModificationService.d.ts","text":"import Area from '../../model/area/area';\r\nimport { AreaKey } from '../../model/area/areaKey';\r\nimport Player from '../../model/player/player';\r\nimport { House } from '../../model/player/house';\r\nimport { GameStoreState } from '../../gameStoreState';\r\nimport PlayerSetup from '../../model/player/playerSetup';\r\nexport default class PlayerStateModificationService {\r\n    static raidPowerToken(state: GameStoreState, source: AreaKey, target: AreaKey): Player[];\r\n    static establishControl(players: Player[], establishControl: boolean, house: House): Player[];\r\n    static consolidateAllPower(state: GameStoreState): Player[];\r\n    static executeAllConsolidatePowerOrders(players: Player[], areas: Area[]): Player[];\r\n    static initPlayers(playerSetup: Array<PlayerSetup>): Player[];\r\n}\r\n"}}
